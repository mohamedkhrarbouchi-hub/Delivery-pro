<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Delivery Intelligence OS</title>

<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Delivery OS&quot;,
  &quot;short_name&quot;:&quot;DeliveryOS&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#0f172a&quot;,
  &quot;theme_color&quot;:&quot;#2563eb&quot;
}">

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
    :root {
        --bg: #0f172a;
        --card: #1e293b;
        --accent: #2563eb;
        --danger: #ef4444;
        --text: #f1f5f9;
        --success: #10b981;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 20px;
    }

    h3 { text-align: center; margin-bottom: 25px; font-size: 1.8rem; color: var(--accent); }

    /* Ø´Ø¨ÙƒØ© Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .card {
        background: var(--card);
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255,255,255,0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .card-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 15px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 10px;
    }

    input, select, button {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #334155;
        margin-top: 10px;
        background: #334155;
        color: white;
        outline: none;
        box-sizing: border-box;
    }

    button {
        cursor: pointer;
        background: var(--accent);
        border: none;
        font-weight: bold;
        transition: 0.3s opacity;
    }

    button:hover { opacity: 0.9; }
    
    .btn-danger { background: var(--danger); }
    .btn-success { background: var(--success); }

    .stats-row {
        display: flex;
        justify-content: space-between;
        background: rgba(255,255,255,0.05);
        padding: 10px;
        border-radius: 8px;
        margin-top: 5px;
    }

    .small { font-size: 0.85rem; opacity: 0.7; }
    
    #log {
        max-height: 150px;
        overflow-y: auto;
        font-size: 0.9rem;
    }

    .log-item {
        padding: 8px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        display: flex;
        justify-content: space-between;
    }

    .footer-actions {
        grid-column: 1 / -1;
        display: flex;
        gap: 10px;
    }

    @media (max-width: 600px) {
        .dashboard-grid { grid-template-columns: 1fr; }
    }
</style>
</head>

<body>

<h3>ğŸš€ Delivery Intelligence OS</h3>

<div class="dashboard-grid">
    <div class="card">
        <div class="card-title">ğŸ“¦ ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ÙŠØ©</div>
        <input id="amt" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
        <select id="pay">
            <option value="cash">ÙƒØ§Ø´</option>
            <option value="app">ØªØ·Ø¨ÙŠÙ‚</option>
        </select>
        <input id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <button onclick="addOrder()">Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ÙŠØ©</button>
    </div>

    <div class="card">
        <div class="card-title">â›½ ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ</div>
        <input id="eAmt" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
        <input id="eNote" placeholder="ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ (Ø¨Ù†Ø²ÙŠÙ†ØŒ Ø·Ø¹Ø§Ù…...)">
        <button class="btn-danger" onclick="addExpense()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
    </div>

    <div class="card">
        <div class="card-title">ğŸ“ ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§ÙØ©</div>
        <div class="stats-row">
            <span>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©:</span>
            <b id="km">0 KM</b>
        </div>
        <div class="stats-row">
            <span>Ø±Ø¨Ø­ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±:</span>
            <b id="kmProfit" style="color:var(--success)">0</b>
        </div>
        <div style="display:flex; gap:5px">
            <button class="btn-success" onclick="startTrack()">Ø¨Ø¯Ø¡</button>
            <button class="btn-danger" onclick="stopTrack()">Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
    </div>

    <div class="card">
        <div class="card-title">ğŸ”” ØªØ°ÙƒÙŠØ± Ø°ÙƒÙŠ</div>
        <input id="remTxt" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† Ù†ØªØ°ÙƒØ±ØŸ">
        <input id="remMin" type="number" placeholder="Ø¨Ø¹Ø¯ ÙƒÙ… Ø¯Ù‚ÙŠÙ‚Ø©ØŸ">
        <button onclick="setReminder()">Ø¶Ø¨Ø· Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>
    </div>

    <div class="card">
        <div class="card-title">ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ</div>
        <div class="stats-row">
            <span>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ:</span>
            <b id="net">0</b>
        </div>
        <div class="stats-row">
            <span>Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…ØªÙˆÙØ±:</span>
            <b id="cash" style="color:var(--success)">0</b>
        </div>
    </div>

    <div class="card">
        <div class="card-title">ğŸ“œ Ø¢Ø®Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
        <div id="log"></div>
    </div>

    <div class="footer-actions">
        <button style="background:#555" onclick="exportExcel()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel</button>
    </div>
</div>

<script>
/* Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø¨Ø³ÙŠØ· ÙÙŠ Ø§Ù„Ù€ Render */
const DB="delivery_online";
let state=JSON.parse(localStorage.getItem(DB))||{
    orders:[],expenses:[],km:0,reminders:[]
};

const save=()=>localStorage.setItem(DB,JSON.stringify(state));

function addOrder(){
    let a=+amt.value; if(a<=0) return;
    state.orders.push({a,p:pay.value,n:note.value||'Ø·Ù„Ø¨ÙŠØ©',t:Date.now()});
    amt.value=""; note.value="";
    save(); calc();
}

function addExpense(){
    let a=+eAmt.value; if(a<=0) return;
    state.expenses.push({a,n:eNote.value||'Ù…ØµØ±ÙˆÙ',t:Date.now()});
    eAmt.value=""; eNote.value="";
    save(); calc();
}

function calc(){
    let rev=0,cashVal=0,ex=0;
    state.orders.forEach(o=>{rev+=o.a; if(o.p==="cash") cashVal+=o.a});
    state.expenses.forEach(e=>ex+=e.a);
    
    // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ù„Ù…ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ø±Ø¨Ø­ 50% Ù…Ù† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ - Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ)
    let netVal = (rev * 0.5) - ex;
    let actualCash = cashVal - ex;

    document.getElementById('net').textContent = netVal.toFixed(2);
    document.getElementById('cash').textContent = actualCash.toFixed(2);
    document.getElementById('kmProfit').textContent = (state.km > 0 ? (netVal / state.km).toFixed(2) : 0);
    render();
}

function render(){
    const logEl = document.getElementById('log');
    logEl.innerHTML="";
    [...state.orders,...state.expenses]
    .sort((a,b)=>b.t-a.t).slice(0,8)
    .forEach(i=>{
        let type = i.p ? 'ğŸ“¦' : 'â›½';
        logEl.innerHTML+=`<div class="log-item"><span>${type} ${i.n}</span> <b>${i.a}</b></div>`;
    });
}

/* Ø§Ù„Ù…Ø³Ø§ÙØ© ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ) */
let watchId,lastPos;
function startTrack(){
    if(!navigator.geolocation) return alert("Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…");
    navigator.geolocation.getCurrentPosition(p=>lastPos=p.coords);
    watchId=navigator.geolocation.watchPosition(p=>{
        if(lastPos){
            let d=distance(lastPos.latitude,lastPos.longitude,p.coords.latitude,p.coords.longitude);
            state.km+=d;
            document.getElementById('km').textContent=state.km.toFixed(2)+" KM";
            save();
            calc();
        }
        lastPos=p.coords;
    });
    alert("Ø¨Ø¯Ø£ ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§ÙØ©");
}

function stopTrack(){
    navigator.geolocation.clearWatch(watchId);
    alert("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØªØ¨Ø¹");
}

function distance(lat1,lon1,lat2,lon2){
    const R=6371;
    let dLat=(lat2-lat1)*Math.PI/180;
    let dLon=(lon2-lon1)*Math.PI/180;
    let a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function setReminder(){
    let t=remTxt.value, m=+remMin.value;
    if(!t||m<=0) return;
    state.reminders.push({t,at:Date.now()+m*60000});
    save();
    remTxt.value=""; remMin.value="";
    alert("ØªÙ… Ø¶Ø¨Ø· Ø§Ù„ØªØ°ÙƒÙŠØ±");
}

setInterval(()=>{
    state.reminders=state.reminders.filter(r=>{
        if(Date.now()>=r.at){
            if(Notification.permission==="granted") new Notification("ğŸ”” ØªØ°ÙƒÙŠØ±", {body: r.t});
            else alert("ØªØ°ÙƒÙŠØ±: " + r.t);
            return false;
        }
        return true;
    });
    save();
},10000);

function exportExcel(){
    let wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(state.orders),"Orders");
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(state.expenses),"Expenses");
    XLSX.writeFile(wb,"Delivery_Report.xlsx");
}

// Initial Run
if(Notification.permission!=="granted") Notification.requestPermission();
calc();
</script>

</body>
</html>
.type==="order"){ rev += e.amt; if(e.pay==="cash") cashCol += e.amt; } 
        else ex += e.amt;
    });
    let myGross = rev * (state.settings.rate/100);
    let maintFee = myGross * (state.settings.maint/100);
    let myNet = myGross - ex - maintFee;
    let bossDue = (rev - myGross) - (rev - cashCol);

    document.getElementById('net').textContent = myNet.toFixed(2);
    document.getElementById('cash').textContent = (cashCol - ex).toFixed(2);
    document.getElementById('boss').textContent = bossDue.toFixed(2);
    document.getElementById('mFund').textContent = maintFee.toFixed(2);
    render();
}

function render(){
    const log = document.getElementById('log'); log.innerHTML="";
    state.entries.slice(-20).reverse().forEach(e=>{
        let waLink = e.phone ? `<a href="https://wa.me/${e.phone.replace(/\D/g,'')}" target="_blank" class="wa-btn">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</a>` : '';
        log.innerHTML += `
            <div class="history-item">
                <div>
                    <b>${e.type==='order'?'ğŸ“¦':'â›½'} ${e.note}</b><br>
                    <small>${e.time} ${waLink}</small>
                </div>
                <span style="font-weight:bold; color:${e.type==='order'?'var(--s)':'var(--d)'}">${e.amt}</span>
            </div>`;
    });
}

function saveSettings(){
    state.settings.rate = +document.getElementById('rate').value || 50;
    state.settings.maint = +document.getElementById('maint').value || 5;
    save(); calc(); alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª");
}

function resetDay(){ if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ")){ state.entries=[]; save(); calc(); } }

function exportExcel(){ 
    let ws = XLSX.utils.json_to_sheet(state.entries);
    let wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Report");
    XLSX.writeFile(wb, "Delivery_Report.xlsx");
}

document.getElementById('rate').value = state.settings.rate;
document.getElementById('maint').value = state.settings.maint;
applyTheme();
calc();
</script>
</body>
</html>
ument.getElementById('rate').value = state.settings.rate;
document.getElementById('maint').value = state.settings.maint;
applyTheme();
calc();
</script>
</body>
</html>
